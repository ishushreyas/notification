<body>
<button id ="login">login</button>
  <p id="token"> token</p>

</body>

<script type="module">

 

  // Import the functions you need from the SDKs you need

  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";

  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-analytics.js";

  // TODO: Add SDKs for Firebase products that you want to use

  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration

  // For Firebase JS SDK v7.20.0 and later, measurementId is optional

  const firebaseConfig = {

    apiKey: "AIzaSyBVrRabMjHB6JSWoIxpgDp6Wnn1_eryP6g",

    authDomain: "chat-9a308.firebaseapp.com",

    projectId: "chat-9a308",

    storageBucket: "chat-9a308.appspot.com",

    messagingSenderId: "425014899154",

    appId: "1:425014899154:web:be7fb6b68d239647e2180b",

    measurementId: "G-334Y4TXNJD"

  };
  import{

      getFirestore,Timestamp , doc, getDoc, getDocs, limit, orderBy, query, where, setDoc, collection, addDoc, updateDoc, deleteDoc, deleteField, onSnapshot, arrayUnion

  }from "https://www.gstatic.com/firebasejs/9.8.3/firebase-firestore.js";

  import { getAuth, signInWithPopup,signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider , signOut

  } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-auth.js";
import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-messaging.js";

  // Initialize Firebase

  const app = initializeApp(firebaseConfig);
const auth = getAuth();
const messaging = getMessaging(app);
// Add the public key generated from the console here.
  
  
  
  
  
  
  
  // Saves the messaging device token to Cloud Firestore.

async function saveMessagingDeviceToken() {

  try {

    const currentToken = await getToken(getMessaging());

    if (currentToken) {

      alert('Got FCM device token:'+ currentToken);

      // Saving the Device Token to Cloud Firestore.

     // const tokenRef = doc(getFirestore(), 'fcmTokens', currentToken);

    //  await setDoc(tokenRef, { uid: getAuth().currentUser.uid });

      // This will fire when a message is received while the app is in the foreground.

      // When the app is in the background, firebase-messaging-sw.js will receive the message instead.

      onMessage(getMessaging(), (message) => {

        alert(

          'New foreground notification from Firebase Messaging!'+

          message.notification

        );

      });

    } else {

      // Need to request permissions to show notifications.

      requestNotificationsPermissions();

    }

  } catch(error) {

    alert('Unable to get messaging token.'+ error);

  };

}

  


  
  
  // Requests permissions to show notifications.

async function requestNotificationsPermissions() {

  console.log('Requesting notifications permission...');

  const permission = await Notification.requestPermission();

  

  if (permission === 'granted') {

    console.log('Notification permission granted.');

    // Notification permission granted.

    await saveMessagingDeviceToken();

  } else {

    console.log('Unable to get permission to notify.');

  }

}
  
  
  
  
 

  
async function SigninGoogle(){

    var provider = new GoogleAuthProvider();

   signInWithPopup(auth, provider)

  .then((result) => {

    // This gives you a Google Access Token. You can use it to access the Google API.

    const credential = GoogleAuthProvider.credentialFromResult(result);

    const token = credential.accessToken;

    // The signed-in user info.

    const user = result.user;

    requestNotificationsPermissions();;

    // ...

  }).catch((error) => {

    // Handle Errors here.

    const errorCode = error.code;

    const errorMessage = error.message;

    // The email of the user's account used.

    const email = error.customData.email;

    // The AuthCredential type that was used.

    const credential = GoogleAuthProvider.credentialFromError(error);

    alert( errorMessage);

  });

  }

document.getElementById("login").addEventListener("click", SigninGoogle);




    
  

  

  </script>
